<% include ../partials/header %>

            <div class="ui stackable grid">
                <div class="three wide column">
                </div>
                <div class="two wide column">
                    <p>Zobacz także:</p>
                    <div class="ui segments">
                        <% courses.forEach(function(course){ %>
                        <div class="ui segment">
                            <a class="header" href="/c/<%= course._id %>"><%= course.name %></a>
                        </div>
                        <% }); %>
                    </div>
                </div>
                <div class="six wide column">
                    <img class="ui fluid rounded image" src="<%= course.image %>">
                    <div class="six wide column">
                        <div id="course-description" class="ui segment">
                            <h1><%= course.name %></h1>
                            <p class="course-description"><%= course.description %></p>
                            <em>Dodane przez: <a href="/users/<%= course.author.id %>"><%= course.author.username %></a>, <%= moment(course.createdAt).fromNow() %></em>
                            <% if(currentUser && course.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
                            <div class="ui accordion">
                                <div class="title">
                                    <button class="ui inverted tiny yellow button">Edytuj</button>
                                </div>
                                <div id="review-edit" class="content">
                                    <form id="edit-course-form<%= course._id %>" class="ui large form" action="/c/<%=course._id %>?_method=PUT" method="POST">
                                        <div class="ten wide field">
                                            <input type="text" name="course[name]" value="<%= course.name %>">
                                        </div>
                                        <div class="ten wide field">
                                            <input type="text" name="course[image]" value="<%= course.image %>">
                                        </div>
                                        <div class="ten wide field">
                                            <input type="text" name="course[description]" value="<%= course.description %>">
                                        </div>
                                        <div class="ten wide field">
                                            <button class="ui inverted tiny yellow button">Edytuj</button>
                                        </div>
                                    </form>
                                    <form class="delete-form" action="/c/<%= course._id %>?_method=DELETE" method="POST">
                                        <button class="ui inverted red tiny button">Skasuj</button>
                                    </form>
                                </div>
                            </div>
                            <% } %>
                        </div>
                        <div id="course-description" class="ui segment">
                            <% if (course.rating === 0) { %>
                            <h4>
                                <em>Brak ocen.</em>
                            </h4>
                            <% } else { %>
                            <h4>
                                Ocena:  
                                <% if (course.rating < 1.5) { %> <i class="star icon checked"></i><%- '<i class="star icon"></i>'.repeat(4) %> <% } %>
                                <% if (course.rating > 1.5 && course.rating < 2.5) { %> <%- '<i class="star icon checked"></i>'.repeat(2) %><%- '<i class="star icon"></i>'.repeat(3) %> <% } %>
                                <% if (course.rating > 2.5 && course.rating < 3.5) { %> <%- '<i class="star icon checked"></i>'.repeat(3) %><%- '<i class="star icon"></i>'.repeat(2) %> <% } %>
                                <% if (course.rating > 3.5 && course.rating < 4.5) { %> <%- '<i class="star icon checked"></i>'.repeat(4) %><%- '<i class="star icon"></i>'.repeat(1) %> <% } %>
                                <% if (course.rating > 4.5) { %> <%- '<i class="star icon checked"></i>'.repeat(5) %> <% } %>
                            </h4> 
                            <p>
                                Średnia ocena kursu: <strong><%= course.rating.toFixed(2) %></strong>
                            </p>
                            <div class="ui accordion">
                                <div class="title">
                                    <button class="ui inverted blue button"><i class="eye icon"></i> Zobacz opinie</button>
                                </div>
                                <div id="review-show" class="content">
                                    <div class="ui comments">
                                        <% course.reviews.forEach(function(review){ %>
                                        <div class="comment">
                                            <a class="avatar">
                                                <img src="<%= review.author.avatar %>">
                                            </a>
                                        <div class="content">
                                            <a class="author" href="/users/<%= review.author.id %>"><%= review.author.username %></a>
                                            <div class="metadata">
                                                <span class="date"><%= moment(review.updatedAt).format("DD.MM.YYYY") %></span>
                                                <div class="rating">
                                                    <%- '<i class="star icon checked"></i>'.repeat(review.rating) %><%- '<i class="star icon"></i>'.repeat(5 - review.rating) %>
                                                </div>
                                            </div>
                                            <div class="text">
                                                <%= review.text %>
                                            </div>
                                        </div>
                                        <% if(currentUser && review.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin){ %>
                                        <div class="accordion">
                                            <div class="title">
                                                <button class="ui inverted tiny yellow button">Edytuj</button>
                                            </div>
                                            <div id="review-edit" class="content">
                                                <form id="edit-review-form<%= review._id %>" class="ui large form" action="/c/<%=course._id %>/reviews/<%=review._id %>?_method=PUT" method="POST">
                                                <div class="ten wide field">
                                                    <input type="text" disabled value="<%= currentUser.username %>">
                                                </div>
                                                <div class="ten wide field">
                                                    <fieldset id="rating">
                                                    <div>
                                                        <input type="radio" id="first-rate5" name="review[rating]" value="5" <% if (review.rating === 5) { %> checked <% } %> />
                                                            <%- '<i class="star icon"></i>'.repeat(5) %>
                                                    </div>
                                                    <div>
                                                        <input type="radio" id="first-rate4" name="review[rating]" value="4" <% if (review.rating === 4) { %> checked <% } %> />
                                                            <%- '<i class="star icon"></i>'.repeat(4) %>
                                                    </div>
                                                    <div>
                                                        <input type="radio" id="first-rate3" name="review[rating]" value="3" <% if (review.rating === 3) { %> checked <% } %> />
                                                           <%- '<i class="star icon"></i>'.repeat(3) %>
                                                    </div>
                                                    <div>
                                                        <input type="radio" id="first-rate2" name="review[rating]" value="2" <% if (review.rating === 2) { %> checked <% } %> />
                                                             <%- '<i class="star icon"></i>'.repeat(2) %>
                                                    </div>
                                                    <div>
                                                        <input type="radio" id="first-rate1" name="review[rating]" value="1" <% if (review.rating === 1) { %> checked <% } %> />
                                                            <%- '<i class="star icon"></i>'.repeat(1) %>
                                                    </div>
                                                    </fieldset>
                                                </div>
                                                <div class="ten wide field">
                                                    <textarea name="review[text]" placeholder="Twoja opinia..." form="edit-review-form<%= review._id %>" rows="5" cols="70"><%= review.text %></textarea>
                                                </div>
                                                <div class="ten wide field">
                                                    <button class="ui inverted tiny yellow button">Edytuj</button>
                                                </div>
                                                </form>
                                                <form class="delete-form" action="/c/<%=course._id %>/reviews/<%=review._id %>?_method=DELETE" method="POST">
                                                    <button class="ui inverted red tiny button">Skasuj</button>
                                                </form>
                                            </div>
                                        </div>
                                        <% } %>
                                        </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                                
                            <% if (currentUser && course.reviews.some(function (review) {return review.author.id.equals(currentUser._id)})) { %>
                            <em>Dodałeś już opinię. Możesz ją edytować.</em>
                            <% } else {%>
                            <div class="ui accordion">
                                <div class="title">
                                    <button class="ui inverted green button"><i class="star outline icon"></i> Dodaj opinię </button>
                                </div>
                                <div id="review-add" class="content">
                                    <% if(!currentUser) { %>
                                    <h5>Musisz być zalogowany, aby dodać opinię. <a href="/login">Kliknij tutaj.</a></h5>
                                    <% } %>
                                    <% if(currentUser) { %>
                                    <form id="add-review-form" class="ui large form" action="/c/<%= course._id %>/reviews" method="POST">
                                        <div class="ten wide field">
                                            <label>Użytkownik</label>
                                            <input type="text" disabled value="<%= currentUser.username %>">
                                        </div>
                                        <div class="ten wide field">
                                            <label>Ocena</label>
                                            <fieldset id="rating">
                                            <div>
                                                <input type="radio" id="first-rate5" name="review[rating]" value="5" checked />
                                                    <%- '<i class="star icon"></i>'.repeat(5) %>
                                             </div>
                                             <div>
                                                <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                                                    <%- '<i class="star icon"></i>'.repeat(4) %> 
                                             </div>
                                             <div>
                                                <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                                                    <%- '<i class="star icon"></i>'.repeat(3) %> 
                                             </div>
                                              <div>
                                                <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                                                    <%- '<i class="star icon"></i>'.repeat(2) %>  
                                              </div>
                                            <div>
                                                <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                                                    <%- '<i class="star icon"></i>'.repeat(1) %>
                                            </div>
                                            </fieldset>
                                        </div>
                                        <div class="ten wide field">
                                            <label>Opinia</label>
                                            <textarea class="form-control" name="review[text]" placeholder="Wpisz treść opinii." form="add-review-form"></textarea>
                                        </div>
                                        <div class="ten wide field">
                                            <button class="tiny ui inverted green button">Dodaj</button>
                                        </div>
                                    </form>
                                    <% } %>
                                </div>
                            </div>
                            <% } %>
                        </div>
                        <div id="course-description" class="ui segment">
                            <h4>Komentarze</h4>
                            <% if (course.comments && course.comments.length) { %>
                            <div class="ui accordion">
                                <div class="title">
                                    <button class="ui inverted blue button"><i class="eye icon"></i> Zobacz komentarze</button>
                                </div>
                                <div id="review-show" class="content">
                                    <div class="ui comments">
                                        <% course.comments.forEach(function(comment){ %>
                                        <div class="comment">
                                            <a class="avatar">
                                                <img src="<%= comment.author.avatar %>">
                                            </a>
                                            <div class="content">
                                                <a class="author" href="/users/<%= comment.author.id %>"><%= comment.author.username %></a>
                                                <div class="metadata">
                                                    <span class="date"><%= moment(comment.createdAt).fromNow() %></span>
                                                </div>
                                                <div class="text">
                                                    <%= comment.text %>
                                                </div>
                                            </div>
                                            <% if(currentUser && comment.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin){ %>
                                            <div class="accordion">
                                                <div class="title">
                                                    <button class="ui inverted tiny yellow button">Edytuj</button>
                                                </div>
                                                <div id="review-edit" class="content">
                                                    <form id="edit-comment-form<%= comment._id %>" class="ui large form" action="/c/<%=course._id %>/comments/<%=comment._id %>?_method=PUT" method="POST">
                                                    <div class="ten wide field">
                                                        <input type="text" disabled value="<%= currentUser.username %>">
                                                    </div>
                                                    <div class="ten wide field">
                                                        <textarea name="review[text]" placeholder="Twój komentarz..." form="edit-comment-form<%= comment._id %>"><%= comment.text %></textarea>
                                                    </div>
                                                    <div class="ten wide field">
                                                        <button class="ui inverted tiny yellow button">Edytuj</button>
                                                    </div>
                                                    </form>
                                                    <form class="delete-form" action="/c/<%=course._id %>/comments/<%=comment._id %>?_method=DELETE" method="POST">
                                                        <button class="ui inverted red tiny button">Skasuj</button>
                                                    </form>
                                                </div>
                                            </div>
                                            <% } %>
                                        </div>
                                        <% }); %>
                                    
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <div class="ui accordion">
                                <div class="title">
                                    <button class="ui inverted green button"><i class="comments outline icon"></i> Dodaj komentarz</button>
                                </div>
                                <div id="review-add" class="content">
                                    <% if(!currentUser) { %>
                                    <h5>Musisz być zalogowany, aby dodać komentarz. <a href="/login">Kliknij tutaj.</a></h5>
                                    <% } %>
                                    <% if(currentUser) { %>
                                    <form id="add-comment-form" class="ui large form" action="/c/<%= course._id %>/comments" method="POST">
                                        <div class="ten wide field">
                                            <input type="text" disabled value="<%= currentUser.username %>">
                                        </div>
                                        <div class="ten wide field">
                                            <textarea name="comment[text]" placeholder="Wpisz treść komentarza." form="add-comment-form"></textarea>
                                        </div>
                                        <div class="ten wide field">
                                            <button class="tiny ui inverted green button">Dodaj komentarz</button>
                                        </div>
                                    </form>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="five wide column">
                </div>
            </div>
        </div>
    </div>
    
<% include ../partials/footer %>

  